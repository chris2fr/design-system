@use "sass:list";
@use "sass:map";
@use "../../selector/function/nest";
@use "../setting/elements";

////
/// Core Tool : Action focus
/// @group core
////

@use '../../../../../module/color';

@mixin focusable-selector($elements: elements.$action-elements) {
  $selectors: ();
  @each $element, $setting in $elements {
    $focus: map.get($setting, focus);
    $isolated: map.get($setting, isolated);
    $selector: map.get($setting, selector);
    @if $focus {
      @if $isolated {
        $isolated-selectors: nest.nest($selector, '&:focus', map.get($focus, selector));
        #{$isolated-selectors} {
          @content;
        }
      }
      @else {
        $selectors: list.append($selectors, nest.nest($selector, '&:focus', map.get($focus, selector)), 'comma');
      }
    }
  }

  #{$selectors} {
    @content;
  }
}

@mixin focusable-selector-focus($elements: elements.$action-elements) {
  $selectors: ();
  @each $element, $setting in $elements {
    $focus: map.get($setting, focus);
    $isolated: map.get($setting, isolated);
    $selector: map.get($setting, selector);
    @if $focus {
      @if $isolated {
        $isolated-selectors: nest.nest($selector, '&:focus', map.get($focus, selector));
        #{$isolated-selectors} {
          @content;
        }
      }
      @else {
        $selectors: list.append($selectors, nest.nest($selector, '&:focus', map.get($focus, selector)), 'comma');
      }
    }
  }

  #{$selectors} {
    @content;
  }
}

@mixin focusable-selector-focus-not-visible($elements: elements.$action-elements) {
  $selectors: ();
  @each $element, $setting in $elements {
    $focus: map.get($setting, focus);
    $isolated: map.get($setting, isolated);
    $selector: map.get($setting, selector);
    @if $focus {
      @if $isolated {
        $isolated-selectors: nest.nest($selector, '&:focus:not(:focus-visible)', map.get($focus, selector));
        #{$isolated-selectors} {
          @content;
        }
      }
      @else {
        $selectors: list.append($selectors, nest.nest($selector, '&:focus:not(:focus-visible)', map.get($focus, selector)), 'comma');
      }
    }
  }

  #{$selectors} {
    @content;
  }
}

@mixin focusable-selector-focus-visible($elements: elements.$action-elements) {
  $selectors: ();

  @each $element, $setting in $elements {
    $focus: map.get($setting, focus);
    $isolated: map.get($setting, isolated);
    $selector: map.get($setting, selector);
    @if $focus {
      @if $isolated {
        $isolated-selectors: nest.nest($selector, '&:focus-visible', map.get($focus, selector));
        #{$isolated-selectors} {
          @content;
        }
      }
      @else {
        $selectors: list.append($selectors, nest.nest($selector, '&:focus-visible', map.get($focus, selector)), 'comma');
      }
    }
  }

  #{$selectors} {
    @content;
  }
}

@mixin focusable($elements: elements.$action-elements) {
  @include focusable-selector($elements) {
    outline-offset: 2px;
    outline-width: 2px;
    outline-color: color.$focus;
  }

  @include focusable-selector-focus($elements) {
    outline-style: solid;
  }

  @include focusable-selector-focus-not-visible($elements) {
    outline-style: none;
  }

  @include focusable-selector-focus-visible($elements) {
    outline-style: solid;
  }
}
