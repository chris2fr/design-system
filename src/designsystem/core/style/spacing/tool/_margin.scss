@use "sass:map";
@use "sass:math";
@use "sass:meta";
@use "../../selector/function/namespace";
@use "../../selector/tool/breakpoint";

////
/// Core Module : Spacing
/// @group tools
////

@use '../../../../../module/spacing';
@use '../../../../../module/string' as str;
@use 'sass:string';

@function _spacing-name($prop: margin, $side:top, $value:1, $unit: null, $breakpoint: null) {
  $start: string.slice($prop, 1, 1);

  @if $side != null {
    $start: '#{string.slice($prop, 1, 1)}#{string.slice($side, 1, 1)}';
  }

  $middle: '';

  @if $breakpoint != null {
    $middle: '#{$breakpoint}-';
  }

  $end: "#{str.replace($value, '.', '-')}";

  @if meta.type-of($value) == 'number' and $value < 0 {
    $end: "n#{str.replace(math.abs($value), '.', '-')}";
  }

  @if $value != 0 and $unit != null {
    $end: '#{$end}#{$unit}';
  }

  $selector: '#{$start}-#{$middle}#{$end}';

  @return $selector;
}

@function _spacing-selectors($prop, $side, $value, $breakpoint) {
  @if meta.type-of($value) != 'number' {
    @return '#{namespace.ns(_spacing-name($prop, $side, $value, null, $breakpoint))}';
  }

  $w: null;
  @if (math.abs($value) % 2) == 0 and $value != 0 {
    $w: math.abs($value) * 0.5;
  }

  $selectors:'#{namespace.ns(_spacing-name($prop, $side, $value, v, $breakpoint))}';

  @if $w != null {
    $selectors: '#{$selectors},#{namespace.ns(_spacing-name($prop, $side, $value * 0.5, w, $breakpoint))}';
  }

  @return $selectors;
}

@mixin _spacing-property-variations($prop:margin, $value:1, $breakpoint: null) {
  $v: $value;

  @if meta.type-of($value) == 'number' {
    $v: spacing.space('#{$value}v') !important;
  }

  #{_spacing-selectors($prop, null, $value, $breakpoint)} {
    #{$prop}: $v;
  }

  @each $dir, $sides in (x:left right, y: top bottom) {
    @each $side in $sides {
      #{_spacing-selectors($prop, $side, $value, $breakpoint)},
      #{_spacing-selectors($prop, $dir, $value, $breakpoint)} {
        #{$prop}-#{$side}: $v;
      }
    }
  }
}

@mixin _spacing-properties($prop, $settings, $breakpoint:null) {
  $active: map.get($settings, active);
  $from: map.get($settings, from);
  $half: map.get($settings, half);
  $through: map.get($settings, through);
  $specials: map.get($settings, special);

  @if $active != false {
    @for $i from $from through $through {
      @include _spacing-property-variations($prop, $i, $breakpoint);
      // ajoute 0.5v & 1.5v et -0.5v & -1.5v ($half=2)
      @if $i > -$half and $i < $half {
        @if $i <= 0 and $from < 0 {
          @include _spacing-property-variations($prop, $i - 0.5, $breakpoint);
        }
        @if $i >= 0 {
          @include _spacing-property-variations($prop, $i + 0.5, $breakpoint);
        }
      }
    }

    @each $special in $specials {
      @include _spacing-property-variations($prop, $special, $breakpoint);
    }
  }
}

@mixin create-spacing-properties($settings) {
  @each $prop, $setting in $settings {
    @include _spacing-properties($prop, $setting);

    @if map.has-key($setting, breakpoints) {
      @each $breakpoint in map.get($setting, breakpoints) {
        @include breakpoint.respond-from($breakpoint) {
          @include _spacing-properties($prop, $setting, $breakpoint);
        }
      }
    }
  }
}
